<!--
Citation for CS 340 Project - Group 28
Date: 11/06/2025 (Web Application), 1/28/2025 (CUD)
Adapted from and based on CS 340 - Explorations - Web Application Technology and Implementing CUD operations in your app
Source URL (Web Application): https://canvas.oregonstate.edu/courses/2017561/pages/exploration-web-application-technology-2?module_item_id=25645131
Source URL (CUD): https://canvas.oregonstate.edu/courses/2017561/pages/exploration-implementing-cud-operations-in-your-app?module_item_id=25645149

AI tools were used: 
date: 12/1/2025
prompts - "how to make the update form inline in this hbs document so that once an "EDIT" button is hit, an update form for that line will show up right below it?"
Source URL: https://copilot.microsoft.com/

date: 12/04/2025
prompt - "How can I make the dropdowns in my update form preselected with current value?"
Source URL: https://copilot.microsoft.com/

date: 12/05/2025
prompt - "How can I make the create form insert both into Orders and BookOrderDetails tables in one submission?"
Source URL: https://copilot.microsoft.com/

date: 12/05/2025
prompt - "How can I enable selection of more than one book for one order?"
Source URL: https://copilot.microsoft.com/

!-->

<h1>Orders</h1>
<h2>View, Delete, and Update Orders</h2>

{{! READ table }}
<table>
  <thead>
    <tr>
      <th>Order ID</th>
      <th>User</th>
      <th>Date</th>
      <th>Total Price</th>
      <th>Street</th>
      <th>City</th>
      <th>State</th>
      <th>Zip Code</th>
      <th>Coupon Code</th>
      <th>Actions</th>
    </tr>
  </thead>

  <tbody>
    {{#each orders}}
    <tr>
      <td>{{this.orderID}}</td>
      <td>{{this.user}}</td>
      <td>{{this.orderDate}}</td>
      <td>{{this.totalPrice}}</td>
      <td>{{this.street}}</td>
      <td>{{this.city}}</td>
      <td>{{this.state}}</td>
      <td>{{this.zipCode}}</td>
      <td>{{this.couponCode}}</td>

      {{! DELETE form }}
      <td>
        <form action="/orders/delete" method="POST" style="display:inline;">
          <input type="hidden" name="delete_orders_id" value="{{this.orderID}}" />
          <button class="deleteButton" type="submit">Delete</button>
        </form>

      {{! EDIT button }}
        <button class="editButton" type="button" onclick="toggleUpdateForm('{{this.orderID}}')">Edit</button>
      </td>
    </tr>

    {{! Hidden UPDATE form row }}
    <tr id="updateFormRow-{{this.orderID}}" style="display:none;">
      <td colspan="11">
        <form action="/orders/update" method="POST">
          <input type="hidden" name="update_orders_orderID" value="{{this.orderID}}" required/>

          <label>User:</label>
          <select name="update_orders_userID" required>
            {{#each ../users}}
            <option value="{{this.userID}}"
              {{#if (eq this.userID ../userID)}}selected{{/if}}>
              {{this.userID}} - {{this.userName}}
            </option>
            {{/each}}
          </select><br>

          <label>Date:</label>
          <input type="date" name="update_orders_orderDate" value="{{this.orderDate}}" required/><br>

          <label>Total Price:</label>
          <input type="number" step="0.01" name="update_orders_totalPrice" min="0" value="{{this.totalPrice}}" required/><br>

          <label>Street:</label>
          <input type="text" name="update_orders_street" maxlength="100" value="{{this.street}}" required/><br>

          <label>City:</label>
          <input type="text" name="update_orders_city" maxlength="50" value="{{this.city}}" required/><br>

          <label>State:</label>
          <input type="text" name="update_orders_state" maxlength="50" value="{{this.state}}" required/><br>

          <label>Zip Code:</label>
          <input type="text" name="update_orders_zipCode" maxlength="10" value="{{this.zipCode}}" required/><br>

          <label>Coupon:</label>
          <select name="update_orders_couponID">
            <option value="">Select a Coupon</option>
            <option value="">No Coupon</option>
            {{#each ../coupons}}
            <option value="{{this.couponID}}"
            {{#if (eq this.couponID ../couponID)}}selected{{/if}}>
              {{this.couponID}} - {{this.couponCode}}
            </option>
            {{/each}}
          </select><br>

          <input class="submitButton" type="submit" value="Save Update" />
        </form>
      </td>
    </tr>
    {{/each}}
  </tbody>
</table>

{{! CREATE form}}
<h2>Create an Order and Book Order Detail for New Order</h2>
<form class="cuForm" id="create_orders_form" method="POST" action="/orders/create">
  
  {{! Order fields }}
  <h3>Order</h3>
  
  <label for="create_orders_userID">User: </label>
  <select name="create_orders_userID" id="create_orders_userID" required>
    <option value="" disabled selected>Select a User</option>
    {{#each users}}
    <option value="{{this.userID}}">{{this.userID}} - {{this.userName}}</option>
    {{/each}}
  </select><br>

  <label for="create_orders_orderDate">Date:</label>
  <input type="date" name="create_orders_orderDate" id="create_orders_orderDate" required/><br>

  <label for="create_orders_totalPrice">Total Price:</label>
  <input type="number" step="0.01" name="create_orders_totalPrice" id="create_orders_totalPrice" min="0" required/><br>

  <label for="create_orders_street">Street:</label>
  <input type="text" name="create_orders_street" id="create_orders_street" maxlength="100" required/><br>

  <label for="create_orders_city">City:</label>
  <input type="text" name="create_orders_city" id="create_orders_city" maxlength="50" required/><br>

  <label for="create_orders_state">State:</label>
  <input type="text" name="create_orders_state" id="create_orders_state" maxlength="50" required/><br>

  <label for="create_orders_zipCode">Zip Code:</label>
  <input type="text" name="create_orders_zipCode" id="create_orders_zipCode" maxlength="10" required/><br>

  <label for="create_orders_couponID">Coupon:</label>
  <select name="create_orders_couponID" id="create_orders_couponID">
    <option value="" selected>Select a Coupon</option>
    <option value="">No Coupon</option>
    {{#each coupons}}
    <option value="{{this.couponID}}">{{this.couponID}} - {{this.couponCode}}</option>
    {{/each}}
  </select><br>
  
  {{! BookOrderDetails fields }}
  <h3>Book Order Detail</h3>
  
  <div id="bookItems">
    <div class="bookItem">
      <label for="create_bookorderdetails_bookID">Book: </label>
      <select name="create_bookorderdetails_bookID[]" required>
        <option value="" disabled selected>Select a Book</option>
        {{#each books}}
        <option value="{{this.bookID}}">{{this.bookID}} - {{this.title}}</option>
        {{/each}}
      </select><br>
      
      <label for="create_bookorderdetails_quantityOrdered">Quantity: </label>
      <input type="number" name="create_bookorderdetails_quantityOrdered[]" min="0"  required/><br>
      
      <label for="create_bookorderdetails_price">Price: </label>
      <input type="number" step="0.01" name="create_bookorderdetails_price[]" min="0"  required/><br>
    </div>
  </div>

  <button class="submitButton" type="button" onclick="addBookItem()">Add Another Book</button><br><br>

  <input class="submitButton" type="submit" />
</form>

{{! JavaScript toggle function }}
<script>

function toggleUpdateForm(orderID) {
  // Close all other update forms first
  document.querySelectorAll("[id^='updateFormRow-']").forEach(row => {
    row.style.display = "none";
  });

  // Open the selected one
  const row = document.getElementById("updateFormRow-" + orderID);
  if (row) {
    row.style.display = "table-row";
  }
}

function addBookItem() {
  const container = document.getElementById('bookItems');
  const newItem = container.firstElementChild.cloneNode(true);
  container.appendChild(newItem);
}

</script>