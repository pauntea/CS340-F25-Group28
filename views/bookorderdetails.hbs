<!--
Citation for CS 340 Project - Group 28
Date: 11/06/2025 (Web Application), 1/28/2025 (CUD)
Adapted from and based on CS 340 - Explorations - Web Application Technology and Implementing CUD operations in your app
Source URL (Web Application): https://canvas.oregonstate.edu/courses/2017561/pages/exploration-web-application-technology-2?module_item_id=25645131
Source URL (CUD): https://canvas.oregonstate.edu/courses/2017561/pages/exploration-implementing-cud-operations-in-your-app?module_item_id=25645149

// AI tools were used: 
date: 12/01/2025
prompts - "how to make the update form inline in this hbs document so that once an "EDIT" button is hit, an update form for that line will show up right below it?"
Source URL: https://copilot.microsoft.com/

// date: 12/01/2025
// prompt - "How can I assign the old and new values (foreign keys) to be sent to my JS file? + Debugging"
// Source URL: https://copilot.microsoft.com/

// date: 12/04/2025
// prompt - "How can I make the dropdowns in my update form preselected with current value?"
// Source URL: https://copilot.microsoft.com/

!-->

<h1>Book Order Details</h1>
<h2>View and Update Book Order Details</h2>

{{! READ table }}
<table>
    <thead>
        {{! For the table header row, we print the DB attribute names }}
        <tr>
            <th>Book</th>
            <th>Order ID</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Actions</th>
        </tr>
    </thead>

    <tbody>
        {{! For each row, print the book (title), orderID, quantityOrdered, and price }}
        {{#each bookOrderDetails}}
        <tr>
            <td>{{this.book}}</td>
            <td>{{this.orderID}}</td>
            <td>{{this.quantityOrdered}}</td>
            <td>{{this.price}}</td>

            {{! UPDATE - EDIT button }}
            <td>
            <button type="button" onclick="toggleUpdateForm('{{this.orderID}}-{{this.bookID}}')">Edit</button>
            </td>
        </tr>

        {{! Hidden UPDATE form row }}
        <tr id="updateFormRow-{{this.orderID}}-{{this.bookID}}" style="display:none;">
            <td colspan="11">
                <form action="/bookorderdetails/update" method="POST">
                {{!Take note of previous orderID and bookID to reference for change }}
                <input type="hidden" name="old_orderID" value="{{this.orderID}}" required>
                <input type="hidden" name="old_bookID" value="{{this.bookID}}" required>

                <label>Book: </label>
                <select name="update_bookorderdetails_bookID" required>
                    {{#each ../books}}
                    <option value="{{this.bookID}}" {{#if (eq this.bookID ../bookID)}}selected{{/if}}>
                        {{this.title}} - {{this.bookID}}
                    </option>
                    {{/each}}
                </select><br>

                <label>OrderID: </label>
                <select name="update_bookorderdetails_orderID" required>
                    {{#each ../orderID}}
                    <option value="{{this.orderID}}" {{#if (eq this.orderID ../orderID)}}selected{{/if}}>
                        {{this.orderID}}
                    </option>
                    {{/each}}
                </select><br>

                <label for='update_bookorderdetails_quantityOrdered'>Quantity: </label>
                <input type="number" name="update_bookorderdetails_quantityOrdered" min="0" value="{{this.quantityOrdered}}"/><br>

                <label for='update_bookorderdetails_price'>Price: </label>
                <input type="number" step = "0.01" name="update_bookorderdetails_price" min="0" value="{{this.price}}"/>
                <br>
                
                <input type="submit" value="Save Update" />
                </form>
            </td>
        </tr>
        {{/each}}
    </tbody>
</table>

{{! JavaScript toggle function, Source: Copilot }}
<script>
function toggleUpdateForm(id) {
  // Hide all update forms
  document.querySelectorAll("[id^='updateFormRow-']").forEach(row => {
    row.style.display = "none";
  });

  // Show the selected form
  const row = document.getElementById("updateFormRow-" + id);
  if (row) {
    row.style.display = "table-row";
  }
}
</script>
