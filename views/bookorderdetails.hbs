<!--
Citation for CS 340 Project - Group 28
Date: 11/06/2025 (Web Application), 1/28/2025 (CUD)
Adapted from and based on CS 340 - Explorations - Web Application Technology and Implementing CUD operations in your app
Source URL (Web Application): https://canvas.oregonstate.edu/courses/2017561/pages/exploration-web-application-technology-2?module_item_id=25645131
Source URL (CUD): https://canvas.oregonstate.edu/courses/2017561/pages/exploration-implementing-cud-operations-in-your-app?module_item_id=25645149

// AI tools were used: 
date: 11/28/2025
prompts - "I have two select fields. I want to update the second drop-down list options to display only values that are under the selected first value. 
           How can I implement this when I am using SQL and HBS to display the choices? I want HBS to show the values when I do SELECT WHERE."
        - Reload fixes - JS script for fetch + JS Debugging
Source URL: https://copilot.microsoft.com/

!-->

<h1>Book Order Details</h1>
<h2>View and Update Book Order Details</h2>

{{! READ table }}
<table>
    <thead>
        {{! For the table header row, we print the DB attribute names }}
        <tr>
            <th>Book</th>
            <th>Order ID</th>
            <th>Quantity</th>
            <th>Price</th>
        </tr>
    </thead>

    <tbody>
        {{! For each row, print the book (title), orderID, quantityOrdered, and price }}
        {{#each bookOrderDetails}}
        <tr>
            <td>{{this.book}}</td>
            <td>{{this.orderID}}</td>
            <td>{{this.quantityOrdered}}</td>
            <td>{{this.price}}</td>
        </tr>
        {{/each}}
    </tbody>
</table>

{{! UPDATE form }}
<h2>Update Book Order Details</h2>
<form class='cuForm' id='update_bookOrderDetails_form' method='POST' action='/bookorderdetails/update'>
    <label for='update_bookorderdetails_orderID'>Order ID:</label>
    <select name='update_bookorderdetails_orderID' id='update_bookorderdetails_orderID' onchange='this.form.submit()' required>
        <option value='' disabled selected>Select an order</option>
        {{#each orderID}}
        <option value='{{this.orderID}}' required>
            {{this.orderID}}
        </option>
        {{/each}}
    </select>
    <br>

    <label for='update_bookorderdetails_bookID'>Book: </label>
    <select name='update_bookorderdetails_bookID' id='update_bookorderdetails_bookID' required>
        <option value='' disabled selected>Select a book</option>
        {{#each books}}
        <option value='{{this.bookID}}' required>
            {{this.bookID}}
            -
            {{this.title}}
        </option>
        {{/each}}
    </select>
    <br>

    <label for='update_bookorderdetails_quantityordered'>Quantity: </label>
    <input type='number' name='update_bookorderdetails_quantityOrdered' id='update_bookorderdetails_quantityordered' min='0' />
    <br>

    <label for='update_bookorderdetails_price'>Price: </label>
    <input type='number' step = "0.01" name='update_bookorderdetails_price' id='update_bookorderdetails_price' min='0' />
    <br>
    
    <input type='submit' />
</form>

<script>
    document.getElementById('update_bookorderdetails_orderID').addEventListener('change', function() {
    const orderID = this.orderID;
    fetch(`/bookorderdetails/get-books?orderID=${orderID}`)
        .then(res => res.json())
        .then(data => {
        const bookSelect = document.getElementById('bookSelect');
        bookSelect.innerHTML = '';
        data.forEach(book => {
            const option = document.createElement('option');
            option.value = book.bookID;
            option.textContent = book.title;
            bookSelect.appendChild(option);
        });
        });
    });
</script>
